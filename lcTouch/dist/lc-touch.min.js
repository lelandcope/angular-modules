/*! 
 lcTouch v0.5.3 
 Author: Leland Cope @lelandcope 
 2014-05-22 
 */

!function(exports,global){global["true"]=exports;var lcTouch;lcTouch=angular.module("lcTouch",[]),lcTouch.directive("ngTap",["$timeout",function($timeout){return function(scope,elem,attrs){var distanceThreshold,tapped,timeThreshold;return distanceThreshold=25,timeThreshold=500,tapped=!1,elem.on("touchstart",function(startEvent){var moveHandler,removeTapHandler,startX,startY,tapHandler,target,touchStart;return target=startEvent.target,touchStart=startEvent.originalEvent.touches[0],startX=touchStart.pageX,startY=touchStart.pageY,removeTapHandler=function(){return $timeout.cancel(),elem.off("touchmove",moveHandler),elem.off("touchend",tapHandler)},tapHandler=function(endEvent){return endEvent.preventDefault(),removeTapHandler(),target===endEvent.target?(tapped=!0,scope.$apply(attrs.ngTap)):void 0},moveHandler=function(moveEvent){var moveX,moveY,touchMove;return touchMove=moveEvent.originalEvent.touches[0],moveX=touchMove.pageX,moveY=touchMove.pageY,Math.abs(moveX-startX)>distanceThreshold||Math.abs(moveY-startY)>distanceThreshold?(tapped=!0,removeTapHandler()):void 0},$timeout(removeTapHandler,timeThreshold),elem.on("touchmove",moveHandler),elem.on("touchend",tapHandler)}),elem.bind("click",function(){return tapped?void 0:scope.$apply(attrs.ngTap)})}}]),lcTouch.directive("ngDbltap",["$timeout",function($timeout){return function(scope,elem,attrs){var distanceThreshold,tapcount,tapped,timeThreshold;return distanceThreshold=25,timeThreshold=500,tapped=!1,tapcount=0,elem.on("touchstart",function(startEvent){var moveHandler,removeTapHandler,startX,startY,tapHandler,target,touchStart;return target=startEvent.target,touchStart=startEvent.originalEvent.touches[0],startX=touchStart.pageX,startY=touchStart.pageY,removeTapHandler=function(){return $timeout.cancel(),elem.off("touchmove",moveHandler),elem.off("touchend",tapHandler),tapcount=0},tapHandler=function(endEvent){return endEvent.preventDefault(),tapcount++,tapcount>=2&&(removeTapHandler(),target===endEvent.target)?(tapped=!0,scope.$apply(attrs.ngDbltap)):void 0},moveHandler=function(moveEvent){var moveX,moveY,touchMove;return touchMove=moveEvent.originalEvent.touches[0],moveX=touchMove.pageX,moveY=touchMove.pageY,Math.abs(moveX-startX)>distanceThreshold||Math.abs(moveY-startY)>distanceThreshold?(tapped=!0,removeTapHandler()):void 0},$timeout(removeTapHandler,timeThreshold),elem.on("touchmove",moveHandler),elem.on("touchend",tapHandler)}),elem.bind("dblclick",function(){return tapped?void 0:scope.$apply(attrs.ngDbltap)})}}]),lcTouch.directive("ngTapOutside",["$timeout",function($timeout){return function(scope,elem,attrs){var onElementTouchStart,onTouchEnd,stopEvent;return stopEvent=!1,angular.isDefined(attrs.when)?scope.$watch(attrs.when,function(newValue){return newValue===!0?$timeout(function(){return elem.bind("touchstart mousedown",onElementTouchStart),$("html").bind("touchend mouseup",onTouchEnd)}):(elem.unbind("touchstart mousedown",onElementTouchStart),$("html").unbind("touchend mouseup",onTouchEnd))}):(elem.bind("touchstart mousedown",onElementTouchStart),$("html").bind("touchend mouseup",onTouchEnd)),onTouchEnd=function(){return stopEvent?stopEvent=!1:$timeout(function(){return scope.$eval(attrs.ngTapOutside)},10)},onElementTouchStart=function(event){return event.stopPropagation(),stopEvent=!0},scope.$on("event:stopTapOutside",function(){return stopEvent=!0})}}]),lcTouch.factory("$swipe",[function(){return{bind:function(elem,events){var endX,endY,ontouchend,ontouchmove,ontouchstart,startX,startY;return startX=0,startY=0,endX=0,endY=0,ontouchstart=function(e){var touch;return touch=e.originalEvent.touches[0],startX=touch.pageX,startY=touch.pageY,elem.on("touchmove",ontouchmove),elem.on("touchend",ontouchend),events.start?events.start(elem,[startX,startY],e):void 0},ontouchmove=function(e){var touch;return touch=e.originalEvent.touches[0],endX=touch.pageX,endY=touch.pageY,events.move?events.move(elem,[endX,endY],e):void 0},ontouchend=function(e){return elem.off("touchmove",ontouchmove),elem.off("touchend",ontouchend),events.end&&events.end(elem,[startX-endX,startY-endY],e),startX=0,startY=0,endX=0,endY=0},elem.on("touchstart",ontouchstart)}}}]),lcTouch.directive("ngSwipeDown",["$swipe",function($swipe){return{restrict:"A",link:function(scope,elem,attrs){var onend,threshold;return threshold=Number(attrs.ngSwipeDownThreshold)||70,onend=function(elem,amounts){var amount;return amount=amounts[1],0>amount&&Math.abs(amount)>=threshold?scope.$apply(attrs.ngSwipeDown):void 0},$swipe.bind(elem,{end:onend})}}}]),lcTouch.directive("ngSwipeUp",["$swipe",function($swipe){return{restrict:"A",link:function(scope,elem,attrs){var onend,threshold;return threshold=Number(attrs.ngSwipeUpThreshold)||70,onend=function(elem,amounts){var amount;return amount=amounts[1],amount>0&&Math.abs(amount)>=threshold?scope.$apply(attrs.ngSwipeUp):void 0},$swipe.bind(elem,{end:onend})}}}]),lcTouch.directive("ngSwipeRight",["$swipe",function($swipe){return{restrict:"A",link:function(scope,elem,attrs){var onend,threshold;return threshold=Number(attrs.ngSwipeRightThreshold)||70,onend=function(elem,amounts){var amount;return amount=amounts[0],0>amount&&Math.abs(amount)>=threshold?scope.$apply(attrs.ngSwipeRight):void 0},$swipe.bind(elem,{end:onend})}}}]),lcTouch.directive("ngSwipeLeft",["$swipe",function($swipe){return{restrict:"A",link:function(scope,elem,attrs){var onend,threshold;return threshold=Number(attrs.ngSwipeLeftThreshold)||70,onend=function(elem,amounts){var amount;return amount=amounts[0],amount>0&&Math.abs(amount)>=threshold?scope.$apply(attrs.ngSwipeLeft):void 0},$swipe.bind(elem,{end:onend})}}}]),lcTouch.factory("$ngDragSwipeHorizontal",["$swipe","$timeout",function($swipe,$timeout){var DSH,cleanArray,notInArray;return cleanArray=function(arr){var el,i,tmp,_i,_len;for(tmp=[],i=_i=0,_len=arr.length;_len>_i;i=++_i)el=arr[i],el&&tmp.push(el);return tmp},notInArray=function(arr1,arr2){var el,i,tmp,_i,_len;for(tmp=[],i=_i=0,_len=arr1.length;_len>_i;i=++_i)el=arr1[i],-1===arr2.indexOf(el)&&tmp.push(el);return tmp},DSH=function(){function DSH(){}return DSH.prototype.offset=0,DSH.prototype.totalChildren=0,DSH.prototype.wrapperWidth=0,DSH.prototype.minDistance=0,DSH.prototype.minInertia=0,DSH.prototype.movable=[],DSH.prototype.infiniteScroll=!1,DSH.prototype.animating=!1,DSH.prototype.elem=null,DSH.prototype.attrs=null,DSH.prototype.bind=function(scope,elem,attrs,infScroll){var isHorizontalScroll,isVerticalScroll,onend,onmove,onstart,threshold,xStart,yStart,_this=this;return this.elem=elem,this.attrs=attrs,this.totalChildren=this.elem.children().length,this.wrapperWidth=this.elem.parent().width(),this.minDistance=attrs.ngDragSwipeHorizontalMinDistance||.5*this.wrapperWidth,this.minInertia=attrs.ngDragSwipeHorizontalMinInertia||.65,this.infiniteScroll=infScroll||!1,threshold=20,isVerticalScroll=!1,isHorizontalScroll=!1,xStart=null,yStart=null,onstart=function(el,amounts,e){return e.stopPropagation(),isVerticalScroll=!1,isHorizontalScroll=!1,xStart=amounts[0],yStart=amounts[1],$(e.currentTarget).data("touchStart",{x:amounts[0],y:amounts[1],timeStamp:e.timeStamp})},onend=function(el,amounts,e){var distanceMoved,speed,startEvent,time,x1,x2;return e.stopPropagation(),startEvent=$(e.currentTarget).data("touchStart"),x1=_this.offset*_this.wrapperWidth,x2=Math.abs(parseInt($(_this.elem.children()[_this.offset]).css("x"))),distanceMoved=x1-x2,speed=Math.abs(Math.max(Math.min((x2-x1)/Math.max(e.timeStamp-startEvent.timeStamp,1),1),-1)),0>distanceMoved&&(Math.abs(distanceMoved)>=_this.minDistance||speed>=_this.minInertia)&&_this.totalChildren!==_this.offset+1?(_this.offset++,scope.$broadcast("event:lcCarouselNext")):distanceMoved>0&&(Math.abs(distanceMoved)>=_this.minDistance||speed>=_this.minInertia)&&0!==_this.offset&&(_this.offset--,scope.$broadcast("event:lcCarouselPrevious")),0!==distanceMoved?(time=500-500*(75*speed/100),$(_this.movable).transition({x:_this.offset*-_this.wrapperWidth+"px"},time,"out"),$timeout(function(){return $(notInArray(_this.elem.children(),_this.movable)).css({x:_this.offset*-_this.wrapperWidth+"px"}),_this.infiniteScroll?_this.resetOrder(_this.elem,attrs):void 0},time)):void 0},onmove=function(el,amounts,e){var placement,startEvent;return e.stopPropagation(),Math.abs(yStart-amounts[1])>threshold&&!isHorizontalScroll&&(isVerticalScroll=!0),Math.abs(xStart-amounts[0])>threshold&&!isVerticalScroll&&(isHorizontalScroll=!0),isHorizontalScroll?(e.preventDefault(),startEvent=$(e.currentTarget).data("touchStart"),placement=amounts[0]-startEvent.x+_this.offset*-_this.wrapperWidth,0>=placement&&placement>=(_this.totalChildren-1)*-_this.wrapperWidth&&(_this.movable=cleanArray([_this.elem.children()[_this.offset],_this.elem.children()[_this.offset-1],_this.elem.children()[_this.offset+1]]),$(_this.movable).css({x:placement+"px"})),scope.$broadcast("event:lcCarouselStopAutoScroll")):void 0},this.infiniteScroll&&this.resetOrder(),$swipe.bind(this.elem.children(),{move:onmove,start:onstart,end:onend})},DSH.prototype.resetOrder=function(){return this.elem.children().length>2?(0===this.offset&&this.infiniteScroll?(this.elem.prepend(this.elem.children().last()),this.offset=1):this.offset>1&&this.infiniteScroll&&(this.elem.append(this.elem.children().first()),this.offset=1),$(this.elem.children()).css({x:this.offset*-this.wrapperWidth+"px"})):void 0},DSH.prototype.next=function(){var time,_this=this;if(!this.animating)return this.offset++,time=500,this.animating=!0,this.movable=cleanArray([this.elem.children()[this.offset],this.elem.children()[this.offset-1],this.elem.children()[this.offset+1]]),$(this.movable).transition({x:this.offset*-this.wrapperWidth+"px"},time,"out"),$timeout(function(){return _this.infiniteScroll&&_this.resetOrder(),_this.animating=!1},time)},DSH.prototype.previous=function(){var time,_this=this;if(!this.animating)return this.offset--,time=500,this.animating=!0,this.movable=cleanArray([this.elem.children()[this.offset],this.elem.children()[this.offset-1],this.elem.children()[this.offset+1]]),$(this.movable).transition({x:this.offset*-this.wrapperWidth+"px"},time,"out"),$timeout(function(){return _this.infiniteScroll&&_this.resetOrder(),_this.animating=!1},time)},DSH}(),function(){return new DSH}}]),lcTouch.directive("ngDragSwipeHorizontal",["$ngDragSwipeHorizontal",function($ngDragSwipeHorizontal){return{restrict:"A",link:function(scope,elem,attrs){return $ngDragSwipeHorizontal().bind(elem,attrs)}}}]),lcTouch.directive("lcCarouselHorizontal",["$ngDragSwipeHorizontal","$compile","$timeout",function($ngDragSwipeHorizontal,$compile,$timeout){return{restrict:"A",link:function(scope,elem,attrs){var $dsh,autoScrollTimeout,autoScrollUntilClick,start;return scope.forceArrows=attrs.forceArrows,scope.lcCarouselHorizontal=attrs.lcCarouselHorizontal,scope.carouselWidth="0px",scope.carouselHeight="0px",autoScrollUntilClick=scope.$eval(attrs.lcCarouselAutoScroll)||!1,autoScrollTimeout=null,$dsh=$ngDragSwipeHorizontal(),scope.items=scope.$eval(attrs.lcCarouselHorizontal),scope.itemsRendered=function(){return $timeout(start,100)},scope.backgroundImage=function(img){return'url("'+img+'")'},start=function(){var $parent,arrowInner,autoScroll,forceArrows,infiniteScroll,lArrow,rArrow;return infiniteScroll=elem.children().length>2,$dsh.bind(scope,elem,attrs,infiniteScroll),$parent=elem.parent(),forceArrows=attrs.forceArrows,scope.carouselWidth=$parent.width()+"px",scope.carouselHeight=$parent.height()+"px",arrowInner=$("<div/>").css({display:"table-cell",verticalAlign:"middle",height:$parent.height()}),lArrow=$('<div class="arrow left" ng-tap="prevCarouselSlide()" />').css({position:"absolute",top:0,left:0,height:$parent.height(),padding:"0 0 0 10px",cursor:"pointer"}).append(arrowInner.clone().append('<i class="icon-chevron-sign-left"></i>')),rArrow=$('<div class="arrow right" ng-tap="nextCarouselSlide()" />').css({position:"absolute",top:0,right:0,height:$parent.height(),display:"table-cell",verticalAlign:"middle",padding:"0 10px 0 0",cursor:"pointer"}).append(arrowInner.clone().append('<i class="icon-chevron-sign-right"></i>')),$parent.css({position:"relative"}),elem.css({width:$parent.width()*elem.children().length,height:$parent.height(),display:"block",opacity:0}),$timeout(function(){return scope.$apply()},100),$timeout(function(){return $dsh.resetOrder(),$parent.append($compile(lArrow)(scope)),$parent.append($compile(rArrow)(scope)),infiniteScroll||$parent.find(".arrow.left").css("display","none"),elem.animate({opacity:1},300),autoScrollUntilClick?autoScrollTimeout=$timeout(autoScroll,autoScrollUntilClick):void 0},999),autoScroll=function(){return elem.children().length<3?void 0:($timeout.cancel(autoScrollTimeout),scope.nextCarouselSlide(!1),autoScrollTimeout=$timeout(autoScroll,autoScrollUntilClick))},scope.nextCarouselSlide=function(cancelAutoScroll){return void 0===cancelAutoScroll&&(cancelAutoScroll=!0),cancelAutoScroll&&$timeout.cancel(autoScrollTimeout),infiniteScroll||($parent.find(".arrow.left").fadeIn(),$parent.find(".arrow.right").fadeOut()),$timeout(function(){return $dsh.next(),cancelAutoScroll?scope.$emit("event:lcCarouselNext",elem):void 0},1)},scope.prevCarouselSlide=function(cancelAutoScroll){return void 0===cancelAutoScroll&&(cancelAutoScroll=!0),cancelAutoScroll&&$timeout.cancel(autoScrollTimeout),infiniteScroll||($parent.find(".arrow.left").fadeOut(),$parent.find(".arrow.right").fadeIn()),$timeout(function(){return $dsh.previous(),cancelAutoScroll?scope.$emit("event:lcCarouselPrevious",elem):void 0},1)},scope.$on("event:lcCarouselStopAutoScroll",function(){return $timeout.cancel(autoScrollTimeout)}),scope.$on("event:lcCarouselNext",function(){return infiniteScroll?void 0:($parent.find(".arrow.left").fadeIn(),$parent.find(".arrow.right").fadeOut())}),scope.$on("event:lcCarouselPrevious",function(){return infiniteScroll?void 0:($parent.find(".arrow.left").fadeOut(),$parent.find(".arrow.right").fadeIn())})}}}}]),lcTouch.directive("lcCarouselItemsRendered",["$timeout",function($timeout){return{restrict:"A",link:function(scope,elem,attrs){return scope.$last===!0?elem.ready(function(){return $timeout(function(){return scope.$apply(attrs.lcCarouselItemsRendered)},200)}):void 0}}}])}({},function(){return this}());